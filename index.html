<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Creando Wordle por Equipos</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="style.css">
    <meta name="theme-color" content="#0f172a">
</head>

<body>

    <div class="top-bar-container">
        <div class="settings-bar" id="settingsBox">
            <div class="boxHelp">
                <button class="setting-help" onclick="startInteractiveTutorial()" title="C√≥mo jugar">?</button>
                <button id="themeToggle" class="setting-help" onclick="toggleTheme()" title="Modo Oscuro / Claro"
                    style="background: #64748b;">
                    üåì
                </button>
            </div>
        </div>
    </div>

    <div id="winnerOverlay">
        <h1 style="font-size: 6rem; margin: 0;">üèÜ</h1>
        <h2 id="winnerName" style="font-size: 3.5rem; margin: 10px 0; color: #f1f5f9; text-align:center;">GANADOR</h2>
        <p style="font-size: 1.5rem; color: #94a3b8; margin-bottom: 30px;">¬°Torneo Finalizado!</p>
        <button class="btn-next" style="width: 250px; font-size: 1.2rem;" onclick="hardReset()">NUEVO TORNEO</button>
    </div>

    <div id="categoryRoulette" class="roulette-overlay" style="display:none;">
        <div class="roulette-box">
            <div class="roulette-title">CATEGOR√çA</div>
            <div id="rouletteText" class="roulette-text">...</div>
        </div>
    </div>

    <div class="layout">
        <div class="side-i">
            <div style="text-align: center;">
                <h1 style="margin: 0 0 10px 0; font-size: 1.2rem; opacity: 0.4; letter-spacing: 2px;">WORDLE CREANDO
                    SOFT
                </h1>
            </div>
            <br>
            <div id="categoryBox" class="setting-item">
                <label for="categorySelect">CATEGOR√çA:</label>
                <select id="categorySelect" onchange="updateCategoryParams()">
                    <option value="GENERAL">GENERAL (MIXTO)</option>
                    <option value="ANIMALES">ANIMALES</option>
                    <option value="PAISES">PA√çSES / CIUDADES</option>
                    <option value="NOMBRES">NOMBRES</option>
                    <option value="COMIDA">COMIDA</option>
                    <option value="VERBOS">VERBOS</option>
                    <option value="INGLES">PALABRAS EN INGLES</option>
                </select>
            </div>
            <br>
            <div id="goalBox" class="tournament-goal">
                <span>META:</span>
                <input type="number" id="goalInput" value="5" min="1" onchange="saveGoal()">
                <span>PUNTOS</span>
            </div>
            <br>
            <div class="setting-item">
                <label for="timeInput">‚è±Ô∏è</label>
                <input type="number" id="timeInput" value="120" min="30" max="300" onchange="updateCategoryParams()">
                <span>SEGUNDOS</span>
            </div>

            <br>
            <div id="turnIndicator" class="turn-banner">
                TURNO: <span id="activePlayerName">---</span>
            </div>
            <div id="timer">00</div>
            <div id="scoreHeader"></div>
            <br>

        </div>
        <div class="game">
            <div id="grid" class="grid"></div>
            <div id="message"
                style="min-height: 30px; font-weight: 800; color: #ef4444; margin: 5px 0; text-align: center;"></div>
            <div id="keyboard"></div>
            <button id="btnNext" class="btn-next" onclick="resetRound()">SIGUIENTE RONDA</button>
        </div>

        <div class="side-d">
            <h3 id="nameA" class="team-name" contenteditable="true" onblur="saveNames()">EQUIPO UNO</h3>
            <div id="turnStatA" class="turn-stat">Partidas: 0</div>
            <div id="histA" style="width: 50%; margin: 10px;justify-content: center;"></div>
            <br>
            <br>
            <h3 id="nameB" class="team-name" contenteditable="true" onblur="saveNames()">EQUIPO DOS</h3>
            <div id="turnStatB" class="turn-stat">Partidas: 0</div>
            <div id="histB" style="width: 50%; margin: 10px;justify-content: center;""></div>
        </div>
        <button id="nextRoundBtn" class="btn-reset-all" onclick="hardReset()">‚ö†Ô∏è REINICIAR TORNEO</button>

            </div>


            <footer class="game-footer">
                <p>Desarrollado por <strong>Marbin Alarc√≥n</strong> &copy; 2026</p>
                <p style="font-size: 0.75rem; margin-top: 5px;">Con colaboraci√≥n de <strong>Creando Soft Ltda.</strong>
                </p>
            </footer>

            <div id="tutorialOverlay" class="tutorial-overlay" style="display: none;">
                <div id="tutorialArrow" class="tutorial-arrow"></div>
                <div id="stepContent" class="step-card">
                    <h3 id="stepTitle">T√≠tulo</h3>
                    <p id="stepText">Texto...</p>
                    <div class="step-footer">
                        <button onclick="nextStep()" id="btnNextStep">Siguiente</button>
                        <button onclick="skipTutorial()" class="btn-skip">Saltar</button>
                    </div>
                </div>
            </div>

            <div id="tutorialModal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <h2>C√≥mo Jugar</h2>
                    <p>Adivina la palabra oculta en 6 intentos.</p>

                    <hr style="width:100%; border:0; border-top:1px solid #eee; margin:15px 0;">

                    <div style="text-align: left; width: 100%;">
                        <div class="example-row">
                            <div class="cell-mini correct">G</div>
                            <div class="cell-mini absent">A</div>
                            <div class="cell-mini absent">T</div>
                            <div class="cell-mini absent">O</div>
                            <div class="cell-mini absent">S</div>
                        </div>
                        <p><small><strong>VERDE:</strong> La letra G est√° en la palabra y en la posici√≥n
                                correcta.</small></p>

                        <div class="example-row">
                            <div class="cell-mini absent">P</div>
                            <div class="cell-mini present">E</div>
                            <div class="cell-mini absent">R</div>
                            <div class="cell-mini absent">R</div>
                            <div class="cell-mini absent">O</div>
                        </div>
                        <p><small><strong>AMARILLO:</strong> La letra E existe pero en otra posici√≥n.</small></p>

                        <div class="example-row">
                            <div class="cell-mini absent">A</div>
                            <div class="cell-mini absent">R</div>
                            <div class="cell-mini absent">B</div>
                            <div class="cell-mini absent">O</div>
                            <div class="cell-mini absent">L</div>
                        </div>
                        <p><small><strong>GRIS:</strong> Esas letras no est√°n en la palabra.</small></p>
                        <br>
                        <div class="fair-play">
                            <strong>üõ°Ô∏è Regla de Fair Play</strong>
                            <span>La ruleta seleccionar√° una tem√°tica de forma aleatoria.</span>
                            <span><span class="warning">¬°Aprovecha!</span> El uso de la categor√≠a solo se contar√° si
                                empiezas a
                                escribir.</span>
                            <span>Si la categor√≠a te parece muy dif√≠cil, puedes pasar el turno antes de tocar el
                                teclado.</span>
                            <span class="limit">L√≠mite: Cada equipo puede usar cada categor√≠a m√°ximo 2 veces por
                                torneo.</span>
                        </div>

                    </div>

                    <button class="btn-next" onclick="closeTutorial()" style="width: 100%;">¬°ENTENDIDO!</button>
                </div>
            </div>
            <div id="lobbyModal" style="display: flex;">
                <div class="modal-content" style="max-width: 350px;">
                    <h2 style="color: var(--text-main); margin-bottom: 15px;">üèÜ TORNEO ONLINE</h2>

                    <p style="margin-bottom: 20px;">Ingresa tus datos para conectarte a la partida.</p>

                    <div style="width: 100%; text-align: left; margin-bottom: 15px;">
                        <label style="display:block; font-weight:bold; margin-bottom:5px;">Tu Nombre:</label>
                        <input type="text" id="playerNick" placeholder="Ej: Juan"
                            style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px;">
                    </div>

                    <div style="width: 100%; text-align: left; margin-bottom: 25px;">
                        <label style="display:block; font-weight:bold; margin-bottom:5px;">Elige tu Equipo:</label>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="selectTeam('A')" id="btnTeamA" class="team-btn"
                                style="flex: 1; padding: 15px; border-radius: 8px; border: 2px solid #3b82f6; background: #eff6ff; color: #3b82f6; font-weight: bold; cursor: pointer;">
                                AZUL (A)
                            </button>
                            <button onclick="selectTeam('B')" id="btnTeamB" class="team-btn"
                                style="flex: 1; padding: 15px; border-radius: 8px; border: 2px solid #f43f5e; background: #fff1f2; color: #f43f5e; font-weight: bold; cursor: pointer;">
                                ROJO (B)
                            </button>
                        </div>
                    </div>

                    <button onclick="joinGame()"
                        style="width: 100%; padding: 12px; background: #10b981; color: white; font-weight: bold; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">
                        ENTRAR A LA SALA üöÄ
                    </button>
                </div>
            </div>

            <style>
                /* Estilos para el Lobby (se superpone a todo) */
                #lobbyModal {
                    position: fixed;
                    z-index: 9999;
                    /* Por encima de todo */
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.85);
                    /* Fondo oscuro */
                    backdrop-filter: blur(5px);
                    align-items: center;
                    justify-content: center;
                }

                .team-btn.selected {
                    background-color: #3b82f6 !important;
                    color: white !important;
                    box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
                }

                #btnTeamB.selected {
                    background-color: #f43f5e !important;
                    box-shadow: 0 0 10px rgba(244, 63, 94, 0.5);
                }
            </style>
            <script type="module">
                // 1. IMPORTAMOS LAS HERRAMIENTAS NECESARIAS
                import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
                import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

                // 2. TU CONFIGURACI√ìN (Aseg√∫rate de que sean tus llaves reales)
                const firebaseConfig = {
                    apiKey: "AIzaSyBw...",
                    authDomain: "torneowordle11.firebaseapp.com",
                    databaseURL: "https://torneowordle11-default-rtdb.firebaseio.com",
                    projectId: "torneowordle11",
                    storageBucket: "torneowordle11.appspot.com",
                    messagingSenderId: "123456789",
                    appId: "1:123456789:web:abcdef"
                };

                // 3. INICIALIZAMOS
                const app = initializeApp(firebaseConfig);
                const db = getDatabase(app);

                // 4. HACEMOS LAS FUNCIONES GLOBALES PARA SCRIPT.JS
                window.db = db;
                window.ref = ref;
                window.set = set;
                window.onValue = onValue;
                window.update = update;

                console.log("üî• Firebase: Conectado y listo");

                // 5. EL ESCUCHADOR (Esto es lo que hace que el Equipo B vea al Equipo A)
                const gameRef = ref(db, 'partida/actual');

                onValue(gameRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        console.log("‚òÅÔ∏è Nube: Datos recibidos", data);
                        // Llamamos a la funci√≥n que est√° en tu script.js
                        if (typeof window.applyCloudChanges === "function") {
                            window.applyCloudChanges(data);
                        }
                    }
                });

                // 6. FUNCI√ìN GLOBAL PARA SUBIR DATOS
                window.syncToCloud = function () {
                    if (window.db && window.stats) {
                        const currentRef = ref(window.db, 'partida/actual');
                        set(currentRef, window.stats)
                            .catch(err => console.error("‚ùå Error al subir:", err));
                    }
                };
            </script>

            <script src="script.js"></script>
            <script>
                // Registro del Service Worker para PWA
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('sw.js').catch(console.error);
                }
            </script>
</body>

</html>